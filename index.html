<!DOCTYPE html>
<html>

<head>
  <title>electrictooth.fm</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="css/reset.css" rel="stylesheet" />
  <link href="css/main.css" rel="stylesheet" />
  <link rel="icon" href="/images/favicon.ico" />
</head>

<body>
  <audio id="audio-ele" type='audio/mpeg'></audio>


  <section class="small-mobile-player" id="smp">

    <div class="mini-progress-bar">
      <div class="middle-align mini-progress-bar__bg" id="mini-progress-bar__track">
        <div class="mini-progress-bar__fg_wrapper">
          <div class="mini-progress-bar__fg" id="mini-progress-bar__progress"></div>
        </div>
      </div>
    </div>

    <div class="smp-control-container">

      <div onclick="toggleMobilePlayer()">
        <img class="fmp-img" src="/images/filler.jpg" style="width: 150px; height: 150px" />
      </div>

      <div onclick="toggleMobilePlayer()" class="smp-details-container">
        <div class="player-title"></div>
        <div class="player-singer"></div>
      </div>

      <div style="width: 64px; margin-right: 36px;">
        <i class="play-icon fa fa-play" style="font-size: 64px;" onclick="play()"></i>
      </div>
    </div>

  </section>

  <section class="full-mobile-player" id="fmp">

    <div class="fmp-img-container">
      <img class="fmp-img" src="/images/filler.jpg" />
    </div>

    <div class="fmp-controls-container">

      <div class="fmp-controls-title">
        <p class="player-title"></p>
        <p class="player-singer"></p>
      </div>

      <div class="fmp-controls-slider">
        <div class="progress-bar">
          <div class="middle-align progress-bar__bg" id="progress-bar__track">
            <div class="progress-bar__fg_wrapper">
              <div class="progress-bar__fg" id="progress-bar__progress"></div>
              <button class="middle-align progress-bar__slider" id="progress-bar__button"></button>
            </div>
          </div>
        </div>
      </div>

      <div class="fmp-controls-player">
        <i class="fa fa-step-backward" style="font-size: 64px;"></i>
        <div style="width: 54px;">
          <i class="play-icon fa fa-play" style="font-size: 64px;" onclick="play()"></i>
        </div>
        <i class="fa fa-step-forward" style="font-size: 64px;" onclick="next()"></i>
      </div>

    </div>

    <div class="fmp-navigation">
      <i class="fa fa-angle-down" style="font-size: 92px; margin-left: 32px;" onclick="toggleMobilePlayer()"></i>
      <i class="fa fa-list" style="font-size: 64px; margin-right: 32px;"></i>
    </div>

  </section>
</body>
<script src="https://connect.soundcloud.com/sdk/sdk-3.3.2.js"></script>
<script>
  var fullMobilePlayerShow = false;
  var smp = document.getElementById("smp");
  var fmp = document.getElementById("fmp");
  var pbt = document.getElementById("progress-bar__track");
  var pbp = document.getElementById("progress-bar__progress");
  pbp.style.transform = `translateX(${-100}%)`
  var pbb = document.getElementById("progress-bar__button");

  var mpbt = document.getElementById("mini-progress-bar__track");
  var mpbp = document.getElementById("mini-progress-bar__progress");
  mpbp.style.transform = `translateX(${-100}%)`

  var playlist = [];
  var currentSong = {};
  var playing = false;
  var loading = false;
  var audio = document.getElementById('audio-ele');
  audio.addEventListener('timeupdate', timeUpdate, false);
  audio.addEventListener('ended', next);

  SC.initialize({
    client_id: 'qar87rq7vEGGfgjM0PqrmTBUYhSzUcQ5',
    redirect_uri: 'https://example.com/callback'
  });

  SC.get(`playlists/1064225653`).then(({ tracks }) => {
    tracks.forEach((song, i) => {
      let me = song.title.split('-')
      let singer = me[0].trim();
      let title = me[1].trim();

      playlist.push({
        id: i,
        title: title,
        singer: singer,
        cover: song.artwork_url.replace('large', 't500x500'),
        musicSrc: `${song.stream_url}?client_id=qar87rq7vEGGfgjM0PqrmTBUYhSzUcQ5`,
        duration: song.duration
      });
    })
    console.log(playlist)
    initPlayer();
  });

  pbb.addEventListener("touchstart", (e) => moveplayhead(e));
  pbb.addEventListener("touchmove", (e) => moveplayhead(e));
  pbb.addEventListener("touchend", (e) => endTouch(e));

  pbt.addEventListener("touchstart", (e) => moveplayhead(e));
  pbt.addEventListener("touchmove", (e) => moveplayhead(e));
  pbt.addEventListener("touchend", (e) => endTouch(e));

  function moveplayhead(e) {
    audio.removeEventListener('timeupdate', timeUpdate, false);
    let newClient
    if (e.touches[0].clientX) {
      newClient = e.touches[0].clientX - pbt.getBoundingClientRect().left;
    }

    if (e.clientX) {
      newClient = e.clientX - pbt.getBoundingClientRect().left;
    }

    let newbutton = 100 * (newClient / pbt.offsetWidth);
    let newprogress = newbutton - 100;

    if (newbutton > 100) {
      pbb.style.left = `${100}%`
      pbp.style.transform = `translateX(${0}%)`

      mpbp.style.transform = `translateX(${0}%)`
      return
    }

    if (newbutton < 0) {
      pbb.style.left = `${0}%`
      pbp.style.transform = `translateX(${-100}%)`

      mpbp.style.transform = `translateX(${-100}%)`
      return
    }

    pbb.style.left = `${newbutton}%`
    pbp.style.transform = `translateX(${newprogress}%)`

    mpbp.style.transform = `translateX(${newprogress}%)`
    return
  }

  function endTouch() {
    let buttonPositionInPercent = pbb.style.left;
    let percentDeci = buttonPositionInPercent.substring(0, buttonPositionInPercent.length - 1);
    percentDeci = percentDeci / 100;
    let newCurrentTime = currentSong.duration * percentDeci
    newCurrentTime = newCurrentTime.toFixed(0);
    newCurrentTime = newCurrentTime / 1000
    audio.currentTime = newCurrentTime;
    audio.addEventListener('timeupdate', timeUpdate, false);
  }

  function play() {
    if (playing) {
      playing = false;
      audio.pause();
      showPlay();
    } else {
      playing = true;
      audio.play();
      showPause();
    }
  }



  function timeUpdate() {
    let buttonPercent = 100000 * (audio.currentTime / currentSong.duration);
    let trackPercent = buttonPercent - 100;
    pbb.style.left = `${buttonPercent}%`
    pbp.style.transform = `translateX(${trackPercent}%)`

    mpbp.style.transform = `translateX(${trackPercent}%)`
  }

  function initPlayer() {
    let titles = document.getElementsByClassName('player-title');
    let singer = document.getElementsByClassName('player-singer');
    let imgs = document.getElementsByClassName('fmp-img');

    currentSong = playlist[0];

    audio.src = currentSong.musicSrc;

    for (e of titles) {
      e.innerHTML = currentSong.title

    }
    for (s of singer) {
      s.innerHTML = currentSong.singer
    }

    for (i of imgs) {
      i.src = currentSong.cover
    }
  }

  function showPause() {
    let playButtons = document.getElementsByClassName('play-icon');

    for (b of playButtons) {
      b.classList.remove('fa-play')
      b.classList.add('fa-pause')
    }
  }

  function showPlay() {
    let playButtons = document.getElementsByClassName('play-icon');

    for (b of playButtons) {
      b.classList.remove('fa-pause')
      b.classList.add('fa-play')
    }
  }

  function next() {

    let titles = document.getElementsByClassName('player-title');
    let singer = document.getElementsByClassName('player-singer');
    let imgs = document.getElementsByClassName('fmp-img');

    let next = currentSong.id + 1;

    if (playlist.length === next) {
      next = 0;
    }

    currentSong = playlist[next];

    audio.src = currentSong.musicSrc;

    for (e of titles) {
      e.innerHTML = currentSong.title

    }
    for (s of singer) {
      s.innerHTML = currentSong.singer
    }

    for (i of imgs) {
      i.src = currentSong.cover
    }

    showPause();
    audio.play();
    playing = true;
  }

  function toggleMobilePlayer() {
    if (fullMobilePlayerShow) {
      smp.style.transitionDelay = "350ms"
      smp.style.transform = "translateY(0)"
      fmp.style.transform = "translateY(100vh)"
      fullMobilePlayerShow = !fullMobilePlayerShow
    } else {
      smp.style.transitionDelay = "0ms"
      smp.style.transform = "translateY(160px)"
      fmp.style.transform = "translateY(0)"
      fullMobilePlayerShow = !fullMobilePlayerShow
    }
  }

  window.onload = function () {
    smp.style.transform = "translateY(0)"
  }
</script>

</html>