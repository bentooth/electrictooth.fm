<!DOCTYPE html>
<html>

<head>
  <title>Page Title</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="css/reset.css" rel="stylesheet" />
  <link href="css/main.css" rel="stylesheet" />
</head>

<body>
  <audio id="audio-ele" type='audio/mpeg'></audio>

  <section class="small-mobile-player" id="smp">
    <i class="fa fa-angle-up" style="font-size: 92px; margin-left: 32px;" onclick="toggleMobilePlayer()"></i>
    <div style="font-size: 64px;">
      <p class="player-title"></p>
      <p class="player-singer"></p>
    </div>
    <i class="fa fa-play" style="font-size: 64px; margin-right: 32px;"></i>
  </section>

  <section class="full-mobile-player" id="fmp">

    <div class="fmp-img-container">
      <img class="fmp-img" src="/images/filler.jpg" />
    </div>

    <div class="fmp-controls-container">

      <div class="fmp-controls-title">
        <p class="player-title"></p>
        <p class="player-singer"></p>
      </div>

      <div class="fmp-controls-slider" style="padding: 0 64px;">
        <div class="progress-bar" style="height: 24px; position:relative; width:100%">
          <div class="middle-align progress-bar__bg" id="progress-bar__track"
            style="background-color:#b3b3b3; border-radius: 12px; display: flex; height:24px; width:100%">
            <div class="progress-bar__fg_wrapper"
              style="overflow:hidden; width:100%; height:24px; border-radius: 12px;">
              <div class="progress-bar__fg" id="progress-bar__progress"
                style="background-color:#05aea5; border-radius: 12px; height: 24px; width:100%">
              </div>
              <button class="middle-align progress-bar__slider" id="progress-bar__button"
                style="z-index: 99; width: 50px;margin-left: -24px;height: 50px;border-radius: 50%;border: 0;background-color: #fff;box-shadow: 0 2px 4px 0 rgba(0,0,0,.5);"></button>
            </div>
          </div>
        </div>
      </div>

      <div class="fmp-controls-player">
        <i class="fa fa-step-backward" style="font-size: 64px;"></i>
        <i class="fa fa-play" style="font-size: 64px;" onclick="play()"></i>
        <i class="fa fa-step-forward" style="font-size: 64px;"></i>
      </div>

    </div>

    <div class="fmp-navigation">
      <i class="fa fa-angle-down" style="font-size: 92px; margin-left: 32px;" onclick="toggleMobilePlayer()"></i>
      <i class="fa fa-list" style="font-size: 64px; margin-right: 32px;"></i>
    </div>

  </section>
</body>
<script src="https://connect.soundcloud.com/sdk/sdk-3.3.2.js"></script>
<script>
  var fullMobilePlayerShow = false;
  var smp = document.getElementById("smp");
  var fmp = document.getElementById("fmp");
  var pbt = document.getElementById("progress-bar__track");
  var pbp = document.getElementById("progress-bar__progress");
  pbp.style.transform = `translateX(${-100}%)`
  var pbb = document.getElementById("progress-bar__button");

  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

  var playlist = [];
  var playing = false;
  var loading = false;
  var onplayahead = false;
  var audio = document.getElementById('audio-ele');
  audio.addEventListener('timeupdate', timeUpdate, false);

  SC.initialize({
    client_id: 'qar87rq7vEGGfgjM0PqrmTBUYhSzUcQ5',
    redirect_uri: 'https://example.com/callback'
  });

  SC.get(`playlists/1064225653`).then(({ tracks }) => {
    tracks.forEach((song) => {
      let me = song.title.split('-')
      let singer = me[0].trim();
      let title = me[1].trim();

      playlist.push({
        title: title,
        singer: singer,
        cover: song.artwork_url.replace('large', 't500x500'),
        musicSrc: `${song.stream_url}?client_id=qar87rq7vEGGfgjM0PqrmTBUYhSzUcQ5`,
        duration: song.duration
      });
    })
    initPlayer()
  });

  pbb.addEventListener("touchstart", (e) => moveplayhead(e));
  pbb.addEventListener("touchmove", (e) => moveplayhead(e));
  pbb.addEventListener("touchend", (e) => endTouch(e));

  pbt.addEventListener("touchstart", (e) => moveplayhead(e));
  pbt.addEventListener("touchmove", (e) => moveplayhead(e));
  pbt.addEventListener("touchend", (e) => endTouch(e));

  function moveplayhead(e) {
    audio.removeEventListener('timeupdate', timeUpdate, false);
    let newClient
    if (e.touches[0].clientX) {
      newClient = e.touches[0].clientX - pbt.getBoundingClientRect().left;
    }

    if (e.clientX) {
      newClient = e.clientX - pbt.getBoundingClientRect().left;
    }

    let newbutton = 100 * (newClient / pbt.offsetWidth);
    let newprogress = newbutton - 100;

    if (newbutton > 100) {
      pbb.style.left = `${100}%`
      pbp.style.transform = `translateX(${0}%)`
      return
    }

    if (newbutton < 0) {
      pbb.style.left = `${0}%`
      pbp.style.transform = `translateX(${-100}%)`
      return
    }

    pbb.style.left = `${newbutton}%`
    pbp.style.transform = `translateX(${newprogress}%)`
    return
  }

  function endTouch() {
    let buttonPositionInPercent = pbb.style.left;
    let percentDeci = buttonPositionInPercent.substring(0, buttonPositionInPercent.length - 1);
    percentDeci = percentDeci / 100;
    let newCurrentTime = playlist[2].duration * percentDeci
    newCurrentTime = newCurrentTime.toFixed(0);
    newCurrentTime = newCurrentTime / 1000
    audio.currentTime = newCurrentTime;
    audio.addEventListener('timeupdate', timeUpdate, false);
  }

  function play() {
    if (playing) {
      audio.pause();
    } else {
      audio.play();
    }
    playing = !playing
  }

  function timeUpdate() {
    let buttonPercent = 100000 * (audio.currentTime / playlist[2].duration);
    let trackPercent = buttonPercent - 100;
    pbb.style.left = `${buttonPercent}%`
    pbp.style.transform = `translateX(${trackPercent}%)`
  }

  function initPlayer() {
    let titles = document.getElementsByClassName('player-title');
    let singer = document.getElementsByClassName('player-singer');
    let imgs = document.getElementsByClassName('fmp-img');

    audio.src = playlist[2].musicSrc;

    for (e of titles) {
      e.innerHTML = playlist[2].title

    }
    for (s of singer) {
      s.innerHTML = playlist[2].singer
    }

    for (i of imgs) {
      i.src = playlist[2].cover
    }
  }

  function toggleMobilePlayer() {
    if (fullMobilePlayerShow) {
      smp.style.transitionDelay = "350ms"
      smp.style.transform = "translateY(0)"
      fmp.style.transform = "translateY(100vh)"
      fullMobilePlayerShow = !fullMobilePlayerShow
    } else {
      smp.style.transitionDelay = "0ms"
      smp.style.transform = "translateY(151px)"
      fmp.style.transform = "translateY(0)"
      fullMobilePlayerShow = !fullMobilePlayerShow
    }
  }

  window.onload = function () {
    smp.style.transform = "translateY(0)"
  }
</script>

</html>